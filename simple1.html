<!DOCTYPE html>
<html>
<body>
The genetic programming algorithm is looking for a  function which maps:<br>
1, 2, 3, 4, 5<br>
to<br>
1, 4, 9, 16, 25<br>
Good luck! And stay patient!<hr>
<p id="bestCodeField"></p>
<script>
var generation=0;
var inp= [1, 2, 3, 4, 5];
var out= [1, 4, 9, 16, 25];
var ga;
var codeBlocks=[
'', // Noop
'a-- ;', 'b-- ;', 'c-- ;', 'd-- ;',  
'a =a;', 'b =a;', 'c =a;', 'd =a;', 
'a =a;', 'a =b;', 'a =c;', 'a =d;', 
'a+=a;', 'a+=b;', 'a+=c;', 'a+=d;', 
'a*=a;', 'a*=b;', 'a*=c;', 'a*=d;', 
'a/=a;', 'a/=b;', 'a/=c;', 'a/=d;', 
'a%=a;', 'a%=b;', 'a%=c;', 'a%=d;', 
];
    
var population = new Array();

function rand(va) {
  return Math.floor(va*Math.random());
}

function randomCode() {
    var code = {};
    code.list=new Array();
    for (var i=0; i<20; i++) {
        code.list[i]=rand(codeBlocks.length);
    }
    return code;
}

function defFooGA(code) {
    code.foo = "ga = function(x) { var a=0, b=0, c=0, d=0; b=x; ";
    for (var i=0; i<code.list.length; i++) {
        code.foo+=codeBlocks[code.list[i]];
    }
    code.foo+="return a;}";
    eval(code.foo);
}
    
function getFitness(code) {
    var fitness=0;
    defFooGA(code);
    for( var i=0; i< inp.length; i++) {
        var y0=out[i];
        var y1=ga(inp[i]);
        if (isNaN(y1)) {
            fitness+=1e100;
        } else {
            fitness+=(y1-y0)*(y1-y0);
        }
    }
    code.fitness=fitness;
    return fitness;
}

function mutate(code) {
    var a=rand(code.list.length);
    code.list[a]=rand(codeBlocks.length);
}

function crossover(target, parent1, parent2) {
    var a=rand(target.list.length);
    for(var i=0, j=0; i<target.list.length; i++) {  
        if (a+i<target.list.length) {
            target.list[i]=parent1.list[a+i];
        } else {
            target.list[i]=parent2.list[j++];
        } 
    }
}

function testAll() {
    for(var i=0; i<population.length; i++) {
        getFitness(population[i]);
    }
    population.sort(function(a,b){return a.fitness-b.fitness});
    defFooGA(population[0]);
    var result="generation="+generation+"<br>fitness="+population[0].fitness+"<br>"+population[0].foo.replace(/;/g,";<br>")+";<br><br>result = {";
    for(var i=0; i< inp.length; i++) {
        result+=inp[i]+", "+ga(inp[i])+", // "+out[i]+",<br>"
    }
    document.getElementById('bestCodeField').innerHTML=result+"};<hr>"; 
}

function nextGeneration() {
    for(var i=population.length-1; i>0; i--) {
        crossover(population[i], population[rand(i)], population[rand(i)]);
        mutate(population[i])
    }
}

function loopThruGenerations() {
    testAll();
    generation++;
    nextGeneration();
    if (population[0].fitness>0.5) setTimeout( loopThruGenerations, 10);
}

for(var i=0; i<10; i++) {
    population[i] = randomCode();
}
loopThruGenerations();

</script>
</body>
</html>

